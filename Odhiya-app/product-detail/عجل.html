<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />

    <!-- page title -->
    <title></title>

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="../assets/css/global/icommon.css"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="../assets/css/global/bootstrap-all.css"
    />

    <link rel="stylesheet" href="../assets/css/global/main.css" />

    <link
      rel="stylesheet"
      type="text/css"
      href="../assets/css/global/custom.css"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="../assets/css/product-details.css"
    />

    <link rel="stylesheet" href="../assets/css/global/styles.css" />
  </head>

  <body class="rtl" data-template="product">
    <style>
      body,
      html {
        font-family: Noto Kufi Arabic, sans-serif;
      }
    </style>

    <div id="app">
      <div class="app d-flex flex-column visible">
        <header id="pageHeader">
          <div style="display: flex">
            <div style="margin-left: 5px"></div>

            <a href="../index.html" class="brand">أضحية</a>
          </div>

          <div
            class="bd-highlight d-flex align-items-center justify-content-end header-cart"
          >
            <div class="d-sm-block">
              <a href="../cart.html" style="color: inherit">
                <h3 v-if="cart.length !== 0" class="cart-header-total">
                  {{selectedCountry}} {{ totalPrice.toLocaleString('en-US', {
                  minimumFractionDigits: 2, maximumFractionDigits: 2 }) }}
                </h3>
              </a>
            </div>
            <div style="position: relative">
              <a
                class="a-shopping-cart"
                href="../cart.html"
                style="color: inherit"
              >
                <span
                  class="icon-shopping_cart_black_36dp-1-1 header-theme-icon-primary"
                  ><span class="path1"></span>
                  <span class="path2"></span>
                </span>
                <span v-if="cart.length !== 0" class="cart-badge"
                  >{{ cart.length }}</span
                >
              </a>
            </div>
          </div>
        </header>

        <section class="breadcrumb-section">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <div class="container d-flex flex-wrap">
                <li class="breadcrumb-item active" aria-current="page">
                  <a href="../index.html">الرئيسية</a> / تفاصيل المنتج
                </li>
              </div>
            </ol>
          </nav>
        </section>

        <div class="main flex-grow-1 app-content">
          <section class="product products-details-page">
            <div class="container pb-5">
              <section class="products-details mb-5">
                <div>
                  <div class="row">
                    <div class="col-lg-6">
                      <!--GALLERY-->
                      <div id="wrap">
                        <div class="row">
                          <div class="col-12 col-product-image-wrapper">
                            <!-- Carousel -->
                            <div
                              class="box-1-1 product-images-carousel product-images-carousel-init"
                            >
                              <div class="content">
                                <div
                                  id="product-images"
                                  class="product-images slide gallery"
                                >
                                  <div id="product-images-slick">
                                    <div>
                                      <div class="box-1-1">
                                        <div class="content">
                                          <a
                                            class="image-link"
                                            style="
                                              display: block;
                                              width: 100%;
                                              height: 100%;
                                            "
                                          >
                                            <img
                                              :src="`../${product.img}`"
                                              class="carousel-img"
                                              alt=""
                                            />
                                          </a>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div
                      class="col-lg-6 col-product-info col-product-info-single-image"
                    >
                      <section>
                        <h1>{{ product.name }}</h1>
                        <div
                          class="d-flex flex-column flex-lg-row product-features"
                        ></div>

                        <p class="text-short-description"></p>
                        <p>
                          ✅المنتج يشمل (تيس ذكر أو ماعز أنثى ) حسب المتوفر.
                        </p>
                        <p>✅يكفي لحوالي 13 شخص تقريبًا.</p>
                        <p>
                          ✅خاصية طباعة الأسماء حسب رغبتكم لتظهر في التقرير
                          النهائي.
                        </p>
                        <p>
                          ✅يتم توزيع اللحوم على القرى والعوائل الأشد حاجة في
                          أفريقيا.
                        </p>
                        <p>
                          ✅ مدة التنفيذ من 3 - 5 أيام عمل كحد أقصى إن شاء الله.
                        </p>
                        <a
                          id="product-description-a"
                          href="#product-description"
                          class="text-color-primary"
                          >المزيد من المعلومات</a
                        >
                      </section>

                      <div class="border-product"></div>
                      <div style="margin-bottom: 25px" class="div-product-sku">
                        <h4 class="product-title">قيمة المنتج</h4>
                        <div class="product-sku">
                          <div class="d-flex">
                            <div>
                              <h2
                                class="product-formatted-price theme-text-primary"
                              >
                                {{ productPrice.toLocaleString('en-US', {
                                minimumFractionDigits: 2, maximumFractionDigits: 2 }) }} {{ currencyCode }}
                              </h2>
                            </div>
                          </div>
                        </div>
                      </div>

                      <form id="product-form">
                        <input
                          id="product.id"
                          type="hidden"
                          value="4c28bee5-b4d1-4f94-a945-ebe276eb7f49"
                        />

                        <div class="size-box">
                          <input
                            id="product-parent-id"
                            type="hidden"
                            value="2e57ceef-f014-43c7-a7b5-3c98b705d386"
                          />
                          <div id="product-variants-options">
                            <div class="form-group">
                              <div>
                                <label>النــية</label>
                                <ul name="النــية" index="0">
                                  <li
                                    v-for="(item, index) in options.niya"
                                    :key="index"
                                    :class="{ active: selectedOptions.النــية === item }"
                                    @click="selectOption('النــية', item)"
                                  >
                                    <span>{{ item }}</span>
                                  </li>
                                </ul>
                              </div>
                            </div>
                            <div class="form-group">
                              <div>
                                <label>الدولة</label>
                                <ul name="الدولة" index="1">
                                  <li
                                    v-for="(item, index) in options.country"
                                    :key="index"
                                    :class="{ active: selectedOptions.الدولة === item }"
                                    @click="selectOption('الدولة', item)"
                                  >
                                    <span>{{ item }}</span>
                                  </li>
                                </ul>
                              </div>
                            </div>
                            <div class="form-group">
                              <div>
                                <label>الإضافات</label>
                                <ul name="الإضافات" index="2">
                                  <li
                                    v-for="(item, index) in options.extras"
                                    :key="index"
                                    :class="{ active: selectedOptions.الإضافات === item }"
                                    @click="selectOption('الإضافات', item), changePrice()"
                                  >
                                    <span>{{ item }}</span>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>

                          <div
                            class="border-product"
                            style="margin-top: 25px"
                          ></div>

                          <div id="product-custom-user-input-fields">
                            <div class="form-group">
                              <label class="input-label">
                                <span
                                  ><span class="text-color-primary"
                                    >الاسم المستخدم في التوثيق</span
                                  >
                                  &nbsp;<small style="color: red">*</small>
                                </span>
                              </label>
                              <div class="input-text">
                                <input
                                  type="text"
                                  data-type="TEXT"
                                  title="الاسم الذي يظهر في التوثيق"
                                  lang="ar"
                                  class="form-control"
                                  id="myInput"
                                  v-model="name"
                                  placeholder="احمد محمد ووالديه"
                                />
                              </div>
                            </div>
                          </div>

                          <div class="custom-field-separator"></div>
                        </div>

                        <div
                          class="border-product"
                          style="margin-top: 15px"
                        ></div>
                        <div class="select-quantity-div">
                          <h4 class="product-title">الكمية</h4>
                          <div class="form-group">
                            <div>
                              <select
                                id="product-quantity"
                                v-model="quantity"
                                class="select-quantity"
                              >
                                <option v-for="n in 100" :value="n" :key="n">
                                  {{ n }}
                                </option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </form>

                      <div class="product-buttons d-block">
                        <div class="border-product"></div>
                        <div class="d-flex align-center">
                          <button
                            style="margin-bottom: 20px"
                            class="btn btn-add-to-cart"
                            type="button"
                            @click="addToCart(product)"
                          >
                            <i
                              class="fa fa-shopping-cart me-1"
                              aria-hidden="true"
                            ></i>
                            <img
                              class="add-to-cart-progress d-none"
                              src="https://assets.zid.store/themes/f9f0914d-3c58-493b-bd83-260ed3cb4e82/spinner.gif"
                              width="25"
                              height="25"
                            />
                            <span>اضف الي السلة</span>
                          </button>
                        </div>
                      </div>

                      <div>
                        <span id="product-view-add-to-cart"></span>
                      </div>

                      <div class="border-product"></div>
                      <div class="border-product">
                        <h4 class="product-title">شارك المنتج</h4>
                        <div class="product-icon">
                          <div class="product-social d-flex">
                            <a
                              :href="`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(pageUrl)}`"
                              target="_blank"
                              ><i class="icon-facebook-f"></i
                            ></a>
                            <a
                              :href="`https://twitter.com/intent/tweet?url=${encodeURIComponent(pageUrl)}&text=${encodeURIComponent('شاهد هذا الرابط!')}`"
                              target="_blank"
                              ><i class="icon-twitter"></i
                            ></a>
                            <a
                              :href="`https://api.whatsapp.com/send?text= اطلع علي المنتج الاتي: ${product.name} ${encodeURIComponent(pageUrl)}`" 
                              target="_blank"
                            >
                              <i class="icon-whatsapp"></i>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>

              <section class="m-5">
                <div class="d-flex align-items-center mb-3">
                  <div
                    class="description-icon"
                    style="font-size: 24px; height: 24px"
                  >
                    <span class="icon-uniE011"></span>
                  </div>
                  <div class="description-title">
                    <div class="">قد يعجبك أيضاً</div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-12">
                    <div id="related-products" class="row g-3">
                      <div
                        v-for="item in otherProducts"
                        :key="item.id"
                        class="col-12 col-sm-6 col-md-4 col-lg-3 prod-col mb-3"
                      >
                        <div class="position-relative">
                          <a
                            @click="selectedProduct(item)"
                            :href="`${slugify(item.name)}.html`"
                            class="text-decoration-none text-dark"
                          >
                            <!-- صورة المنتج -->
                            <img :src="`../${item.img}`" :alt="`../${item.name}`" class="" />

                            <div
                              class="card-body d-flex flex-column justify-content-between"
                            >
                              <!-- اسم المنتج -->
                              <h6 class="card-title mb-4">{{ item.name }}</h6>

                              <!-- السعر -->
                              <div class="mb-2">
                                <span class="">
                                  {{ (item.price[selectedCountry][choosePrice]).toLocaleString('en-US', {
                                  minimumFractionDigits: 2, maximumFractionDigits: 2 }) }}
                                  {{ currencyCode }}
                                </span>
                              </div>
                            </div>
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>
            </div>
          </section>
        </div>

        <div class="footer">
          <footer class="d-flex flex-column">
            <div
              class="d-flex justify-content-center align-items-center flex-wrap p-3"
            >
              <span class="text-center text-white mt-3">
                جميع الحقوق محفوظة لـ مشروع أضحية © 2025
              </span>
            </div>
          </footer>
        </div>
      </div>
    </div>

    <script src="../assets/js/vue.global.js"></script>
    <script type="text/javascript">
      Vue.createApp({
        data: function () {
          return {
            selectedCountry: "SAR",
            currencyCode: "رس",
            choosePrice: "default",
            selected: { code: "SAR", flag: "https://flagcdn.com/sa.svg" },
            product: {},
            productPrice: 0,
            otherProducts: [],
            cart: [],
            selectedOptions: {
              النــية: "صدقة",
              الدولة: "تنزانيا",
              الإضافات: "بدون أرز",
            },
            options: {
              niya: ["عقيقة", "أضحية", "إطعام عام", "صدقة", "كفارة", "النذور"],
              country: ["تنزانيا"],
              extras: ["مع أرز", "بدون أرز"],
            },
            name: "",
            quantity: 1,
            pageUrl: window.location.href
          };
        },
        mounted() {
          const savedCurrency = localStorage.getItem("currency");
          if (savedCurrency) {
            this.selected = JSON.parse(savedCurrency);

            this.selectedCountry = this.selected.code;

            if (this.selected.code == "SAR") {
              this.currencyCode = "رس";
            } else if (this.selected.code == "AED") {
              this.currencyCode = "دإ";
            } else if (this.selected.code == "EGP") {
              this.currencyCode = "جنيه";
            }
          }
          const savedProduct = localStorage.getItem("product");
          if (savedProduct) {
            this.product = JSON.parse(savedProduct);
            this.productPrice =
              this.product.price[this.selectedCountry][this.choosePrice];
          }
          const savedProducts = localStorage.getItem("products");
          if (savedProducts) {
            let parsedProducts = JSON.parse(savedProducts);
            let allData = [];
            parsedProducts.forEach((element) => {
              if (element.id !== this.product.id) {
                allData.push(element);
              }
              this.otherProducts = allData;
            });
          }
          const savedCart = localStorage.getItem("cart");
          if (savedCart) {
            this.cart = JSON.parse(savedCart);
          }
          fetch("assets/js/products.json")
            .then((response) => response.json())
            .then((data) => {
              let allData = [];
              data.forEach((element) => {
                if (element.id !== this.product.id) {
                  allData.push(element);
                }
              });
              this.otherProducts = allData;
            });
          this.headerScroll();
        },
        methods: {
          selectedProduct(product) {
            localStorage.setItem("product", JSON.stringify(product));
          },
          changePrice() {
            if (this.selectedOptions.الإضافات == "مع أرز") {
              this.choosePrice = "vip";
              this.productPrice =
                this.product.price[this.selectedCountry][this.choosePrice];
            } else {
              this.choosePrice = "default";
              this.productPrice =
                this.product.price[this.selectedCountry][this.choosePrice];
            }
          },
          addToCart(product) {
            if (!this.name) {
              const input = document.getElementById("myInput");

              input.style.borderColor = "red";
              input.focus();

              return;
            }
            let cartItem = this.cart;
            let item = {
              product: product,
              price: this.productPrice,
              النــية: this.selectedOptions.النــية,
              الدولة: this.selectedOptions.الدولة,
              الإضافات: this.selectedOptions.الإضافات,
              الاسم: this.name,
              quantity: this.quantity,
            };
            cartItem.push(item);
            this.cart = cartItem;
            localStorage.setItem("cart", JSON.stringify(cartItem));
            this.selectedOptions.النــية = "صدقة";
            this.selectedOptions.الدولة = "تنزانيا";
            this.selectedOptions.الإضافات = "بدون أرز";
            this.name = "";
            this.quantity = 1;
            console.log(this.cart);

            window.location.href = "/../index.html";
          },
          selectOption(key, vlue) {
            this.selectedOptions[key] = vlue;
          },
          headerScroll() {
            window.addEventListener("scroll", function () {
              if (scrollY > 100) {
                document.querySelector("#pageHeader").classList.add("scroll");
              } else {
                document
                  .querySelector("#pageHeader")
                  .classList.remove("scroll");
              }
            });
          },
          slugify(text) {
            return text
              .toString() // تأكيد أنه نص
              .trim() // إزالة المسافات من البداية والنهاية
              .toLowerCase() // تحويل للحروف الصغيرة
              .replace(/\s+/g, "-") // استبدال المسافات بـ -
              .replace(/[^\u0600-\u06FFa-z0-9-]/g, "") // حذف أي رموز غير العربية/الإنجليزية/الأرقام/-
              .replace(/-+/g, "-"); // منع تكرار الشرطات
          },
        },
        computed: {
          totalPrice() {
            return this.cart
              .reduce((sum, item) => sum + item.price * item.quantity, 0)
              .toFixed(2);
          },
        },
      }).mount("#app");
    </script>
  </body>
</html>
